# vue中导入导出 Excel文件

## 使用

- install

```
npm install -S file-saver xlsx（这里其实安装了2个依赖）

npm install -D script-loader
 
```
- src 下新建一个目录 vender ,将 Export2Excel.js 和 Blob.js 放进来,

  在build/webpack.base.conf.js里的这个位置

  `'vendor': path.resolve(__dirname, '../src/vendor')`

  - Blob.js: https://github.com/eligrey/Blob.js
  - Export2Excel.js: 

-百度网盘： https://pan.baidu.com/s/4eUiDNPK 
  - 链接:https://pan.baidu.com/s/1zqIpm8hR40QWSrXdTXvSrg  密码:h8gq

>有的地方说 main.js 引入

```
import Blob from './excel/Blob.js'
import Export2Excel from './excel/Export2Excel.js'
```

- 导出（下载）

```
<el-button :loading="downloadLoading" style="margin:0 0 20px 20px;" type="primary" icon="document" @click="handleDownload">Excel</el-button>

export default {
  name: 'App',
  data(){
    return {
      downloadLoading: false,
      autoWidth: true,
      bookType: 'xlsx',
      filename: '11111111',
      list: [
        {
          id: 1,
          title: '1111',
          author: '1111',
        },
        {
          id: 2,
          title: '2222',
          author: '2222',
        }
      ]
    }
  },

  methods: {
    handleDownload() {
      this.downloadLoading = true
      require.ensure([], () => {
        const { export_json_to_excel } = require('@/excel/Export2Excel')
        const tHeader = ['id', 'title', 'author']
        const filterVal = ['id', 'title', 'author']
        const list = this.list
        const data = this.formatJson(filterVal, list)
        export_json_to_excel(tHeader, data, '列表标题');
        this.downloadLoading = false
      })
    },
    formatJson(filterVal, jsonData) {
      return jsonData.map(v => filterVal.map(j => v[j]))
    }
  },

注意：目前报错了 [Script Loader] ReferenceError: module is not defined
    at eval (eval at module.exports (addScript.js?3fe7:27),

```

- 导入（上传）

>提示需要安装 jQuery 依赖

```
<a href="javascript:;" class="file">导入表格
   <input id="upload" type="file" @change="importfxx(this)"  accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
</a>

importfxx(obj) {
                let _this = this;
                let inputDOM = this.$refs.inputer;
                // 通过DOM取文件数据
                this.file = event.currentTarget.files[0];
                var rABS = false; //是否将文件读取为二进制字符串
                var f = this.file;
                var reader = new FileReader();
                //if (!FileReader.prototype.readAsBinaryString) {
                FileReader.prototype.readAsBinaryString = function(f) {
                    var binary = "";
                    var rABS = false; //是否将文件读取为二进制字符串
                    var pt = this;
                    var wb; //读取完成的数据
                    var outdata;
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var bytes = new Uint8Array(reader.result);
                        var length = bytes.byteLength;
                        for(var i = 0; i < length; i++) {
                            binary += String.fromCharCode(bytes[i]);
                        }
                        var XLSX = require('xlsx');
                        if(rABS) {
                            wb = XLSX.read(btoa(fixdata(binary)), { //手动转化
                                type: 'base64'
                            });
                        } else {
                            wb = XLSX.read(binary, {
                                type: 'binary'
                            });
                        }
                        outdata = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);//outdata就是你想要的东西
                        this.da = [...outdata]
                        let arr = []
                        this.da.map(v => {
                            let obj = {}
                            obj.id = v.id
                            obj.status = v.status
                            arr.push(obj)
                        })
                        console.log(arr)
                        let para = {
                            //withList: JSON.stringify(this.da)
                            withList: arr
                        }
                        _this.$message({
                            message: '请耐心等待导入成功',
                            type: 'success'
                        });
                        withImport(para).then(res => {
                            window.location.reload()
                        })

                    }
                    reader.readAsArrayBuffer(f);
                }
                if(rABS) {
                    reader.readAsArrayBuffer(f);
                } else {
                    reader.readAsBinaryString(f);
                }
            },

```



## 参考
- https://www.cnblogs.com/liguiwang/p/8430672.html
- FileSaver.js: https://github.com/eligrey/FileSaver.js
- js-xlsx: https://github.com/SheetJS/js-xlsx
- [vue中使用xlsx导入excel文件并解析json数据](https://qxiaomay.github.io/2018/07/13/vue%E5%89%8D%E7%AB%AF%E5%AF%BC%E5%85%A5%E5%B9%B6%E8%A7%A3%E6%9E%90excel%E8%A1%A8%E6%A0%BC%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/)
