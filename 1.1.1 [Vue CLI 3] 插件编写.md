# [Vue CLI 3] 插件编写实战和源码分析

## 一个典型的 CLI 插件的目录结构看起来是这样的：
```
.
├── README.md
├── generator.js  # generator (可选)
├── prompts.js    # prompt 文件 (可选)
├── index.js      # service 插件
└── package.json
```



## demo

- 1.首先，创建一个文件夹 vue-cli-plugin-vconsole，新建一个 index.js，外层结构多是固定的：
```
module.exports = (api, projectOptions) => {
  // ...
}
```

- 2.获取在` vue.config.js `中的 `pluginOptions` 配置信息：

```
const {
  vconsole
} = projectOptions.pluginOptions || {}
```

这里我们会用到一个 vconsole 的 webpack 插件：`vconsole-webpack-plugin`

所以用到的是 `api.configureWebpack` 来扩展一下插件：
```
api.configureWebpack(webpackConfig ==> {
  // ...
})
```

- 3.先加载插件

```
const VConsolePlugin = require('vconsole-webpack-plugin')
```

- 4.然后通过 webpackConfig.plugins 访问到所有插件配置，往里 push：
```
webpackConfig.plugins.push(new VConsolePlugin())
```

- 5.最里面就是设置配置项：非线上环境可以设置 enable
```
new VConsolePlugin(Object.assign({
  enable: process.env.NODE_ENV !== 'production'
}, vconsole)
```


## 参考
- [插件开发指南](https://cli.vuejs.org/zh/dev-guide/plugin-dev.html)
- [github-cli-plugin-*](https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue)
- [Creator.js](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli/lib/Creator.js)
- [Service.js](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/Service.js)
- [PluginAPI.js](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/PluginAPI.js)
- [[Vue CLI 3] 插件编写实战和源码分析](https://segmentfault.com/a/1190000016223679)
- [vue-cli-plugin-demo](https://github.com/dailynodejs/vue-cli-plugin-demo)
- [[Vue CLI 3] 插件开发系列之 vconsole](https://segmentfault.com/a/1190000016232151)
